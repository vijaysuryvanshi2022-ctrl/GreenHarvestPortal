<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GreenHarvest - Organic Farming Portal</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(to right, #dcedc1, #a8e6cf);
            color: #392e7d;
        }

        header {
            background-color: #388e3c;
            color: white;
            padding: 20px;
            text-align: center;
        }

        nav {
            margin-top: 10px;
        }

        nav a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }

        .hero {
            background-image: url(https://borgenproject.org/wp-content/uploads/24677187270_30ab46b84b_c.jpg);
            background-size: cover;
            background-position: center;
            height: 50vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 2px 2px 4px #000;
        }

        .hero h1 {
            font-size: 3rem;
        }

        /* Adjusted form-container for better readability on backgrounds */
        .form-container {
            background-color: #ffffffcc; /* Semi-transparent white */
            padding: 25px;
            border-radius: 10px;
            width: 320px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            text-align: center;
            margin: 30px auto;
        }
        
        .section-content-container {
            background-color: rgba(255, 255, 255, 0.75); /* Semi-transparent white overlay */
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            text-align: center;
            margin: 30px auto;
            max-width: 800px;
        }

        label {
            font-weight: bold;
            display: block;
            text-align: left;
            margin-top: 10px;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; /* Ensures padding doesn't affect width */
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #388e3c;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            margin-top: 20px;
            cursor: pointer;
        }

        button:hover {
            background-color: #2e7d32;
        }

        .toggle-link {
            margin-top: 15px;
            font-size: 0.95em;
        }

        .toggle-link a {
            color: #1b5e20;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }

        .toggle-link a:hover {
            text-decoration: underline;
        }

        .hidden {
            display: none;
        }

        .dashboard {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            justify-content: center;
            padding: 20px;
        }

        .card {
            background-color: #e8f5e9;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
            width: 280px;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card h3 {
            margin-top: 0;
            color: #1b5e20;
        }

        iframe {
            width: 100%;
            height: 315px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .welcome {
            text-align: center;
            margin: 20px;
        }

        footer {
            background-color: #c8e6c9;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }

        ul {
            text-align: left;
            margin-top: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 8px;
            border: 1px solid #ccc;
            text-align: left;
        }

        th {
            background-color: #c8e6c9;
        }

        /* Styles for Government Schemes Section */
        #govSchemes ul {
            list-style-type: disc;
            padding-left: 20px;
        }

        /* AI Assistant Specific Styles */
        .ai-response-box {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: left;
            color: #333;
        }

        .loading-dots::after {
            content: ' .';
            animation: dots 1s steps(5, end) infinite;
        }
        @keyframes dots {
            to {
                content: ' ...';
            }
        }

        /* New styles for Products section */
        .products-list {
            text-align: left;
            margin-top: 20px;
        }

        .products-list h4 {
            margin-top: 20px;
            color: #1b5e20;
        }

        .products-list ul {
            list-style-type: none;
            padding: 0;
            margin: 10px 0;
        }
        .products-list li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        /* Message Box Style */
        .message-box {
          position: fixed;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          background-color: #d4edda;
          color: #155724;
          padding: 15px 30px;
          border-radius: 8px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          z-index: 1000;
          font-weight: bold;
          opacity: 0;
          transition: opacity 0.5s ease-in-out;
        }
        .message-box.show {
          opacity: 1;
        }
        
        /* Backgrounds for new sections */
        .principles-bg {
          background-image: url('https://placehold.co/1000x600/699e69/ffffff?text=Green+Principles');
          background-size: cover;
          background-position: center;
        }
        
        .benefits-bg {
          background-image: url('https://placehold.co/1000x600/7ec47e/ffffff?text=Vibrant+Harvest');
          background-size: cover;
          background-position: center;
        }
        
        .community-bg {
          background-image: url('https://placehold.co/1000x600/98d298/ffffff?text=Farming+Community');
          background-size: cover;
          background-position: center;
        }

    </style>
</head>
<body>

    <div id="message-box" class="message-box hidden"></div>

    <header>
        <h1>üåø GreenHarvest Portal</h1>
        <nav>
            <a onclick="showDashboard()">Home</a>
            <a onclick="showPrinciples()">Principles</a>
            <a onclick="showBenefits()">Benefits</a>
            <a onclick="showCommunityTips()">Community</a>
            <a onclick="showProducts()">Products</a>
            <a onclick="showPestAlerts()">Pest Alerts</a>
            <a onclick="showAIAssistant()">AI Expert</a>
            <a onclick="showGovSchemes()">Govt Schemes</a>
            <a onclick="showLogin()">Logout</a>
        </nav>
    </header>

    <div class="hero" id="heroSection">
        <h1>Grow Naturally, Live Healthy</h1>
    </div>

    <div class="form-container" id="loginForm">
        <h3>Login</h3>
        <form onsubmit="event.preventDefault(); showDashboard();">
            <label for="loginEmail">Email:</label>
            <input type="email" id="loginEmail" required>

            <label for="loginPassword">Password:</label>
            <input type="password" id="loginPassword" required>

            <button type="submit">Login</button>
        </form>
        <div class="toggle-link">
            <p>Don't have an account? <a onclick="showSignup()">Sign up here</a></p>
        </div>
    </div>

    <div class="form-container hidden" id="signupForm">
        <h3>Sign Up</h3>
        <form onsubmit="event.preventDefault(); showLogin(); showMessage('Signup successful! You can now log in.');">
            <label for="signupName">Name:</label>
            <input type="text" id="signupName" required>

            <label for="signupEmail">Email:</label>
            <input type="email" id="signupEmail" required>

            <label for="signupPassword">Password:</label>
            <input type="password" id="signupPassword" required>

            <button type="submit">Create Account</button>
        </form>
        <div class="toggle-link">
            <p>Already have an account? <a onclick="showLogin()">Login here</a></p>
        </div>
    </div>

    <main class="hidden" id="dashboard">
        <div class="welcome">
            <h2>Welcome, Farmer!</h2>
            <p>Your digital companion to smarter, sustainable farming.</p>
        </div>

        <div class="dashboard">
            <div class="card" onclick="showCropSuggestion()">
                <h3>üåæ Crop Suggestions</h3>
                <p>Get AI-based crop suggestions based on your soil and region.</p>
            </div>

            <div class="card" onclick="showWeatherForecast()">
                <h3>‚òÄÔ∏è Weather Forecast</h3>
                <p>View weekly weather forecasts for your farm location.</p>
            </div>

            <div class="card" onclick="showProducts()">
                <h3>üìà Organic Products</h3>
                <p>Explore the latest prices and trends in organic products.</p>
            </div>

            <div class="card" onclick="showPestAlerts()">
                <h3>üêõ Pest Alerts</h3>
                <p>Identify and prevent crop diseases using AI insights and videos.</p>
            </div>

            <div class="card" onclick="showAIAssistant()">
                <h3>üë®‚Äçüåæ Talk to AI Expert</h3>
                <p>Ask our AI assistant your farming questions directly.</p>
            </div>

            <div class="card" onclick="showGovSchemes()">
                <h3>üìã Govt Schemes</h3>
                <p>Explore available subsidies and government schemes for farmers.</p>
            </div>
        </div>
    </main>

    <main class="hidden principles-bg" id="principles">
        <div class="section-content-container">
            <h3>Core Principles of Organic Farming üå±</h3>
            <p>Organic farming is built on four key principles that guide sustainable and ethical agricultural practices.</p>
            
            <div style="margin-top: 20px;">
                <h4>1. Health</h4>
                <p>Sustain and enhance the health of soil, plants, animals, and humans as one interconnected system. Healthy soil produces healthy crops, which in turn leads to healthy food for humans.</p>
            </div>
            
            <div style="margin-top: 20px;">
                <h4>2. Ecology</h4>
                <p>Base the system on living ecological cycles, working with nature to imitate and sustain them. This includes respecting the biodiversity of the ecosystem and using natural processes to manage the farm.</p>
            </div>

            <div style="margin-top: 20px;">
                <h4>3. Fairness</h4>
                <p>Build relationships that ensure equity and respect for all living beings and the environment. This principle extends to fair wages for farmers, humane treatment of animals, and equitable distribution of resources.</p>
            </div>

            <div style="margin-top: 20px;">
                <h4>4. Care</h4>
                <p>Manage in a cautious and responsible manner to protect the health of present and future generations and the environment. This involves taking a long-term approach, considering the impact of farming decisions on future soil fertility and climate stability.</p>
            </div>

            <button onclick="goBackToDashboard()">üîô Back to Dashboard</button>
        </div>
    </main>

    <main class="hidden benefits-bg" id="benefits">
        <div class="section-content-container">
            <h3>Key Benefits of Organic Farming ‚ú®</h3>
            <p>Switching to organic practices offers significant advantages for the environment, farmers, and consumers.</p>
            <div style="text-align: left; margin-top: 20px;">
                <ul>
                    <li><strong>Improved Soil Health:</strong> Organic methods like composting and cover cropping enrich the soil with organic matter, leading to better structure, water retention, and nutrient availability.</li>
                    <li><strong>Increased Biodiversity:</strong> By avoiding synthetic pesticides and fertilizers, organic farms support a wider variety of plants, insects, and animals, creating a more resilient ecosystem.</li>
                    <li><strong>Reduced Water Pollution:</strong> The absence of chemical runoff prevents contamination of groundwater and local waterways.</li>
                    <li><strong>Healthier Food:</strong> Organic produce often has higher levels of certain nutrients and is free from pesticide residues.</li>
                    <li><strong>Mitigation of Climate Change:</strong> Organic farming practices help sequester carbon in the soil, which helps to mitigate climate change.</li>
                </ul>
            </div>
            <button onclick="goBackToDashboard()">üîô Back to Dashboard</button>
        </div>
    </main>

    <main class="hidden community-bg" id="community-tips">
        <div class="section-content-container">
            <h3>üë®‚Äçüåæ Community Tips</h3>
            <p>Share your knowledge and read tips from other organic farmers!</p>

            <div id="tips-list" style="text-align: left; margin-top: 20px;">
                <!-- Tips will be rendered here -->
            </div>
            <p id="no-tips-message" style="text-align: center; color: #777; margin-top: 20px;"></p>

            <form onsubmit="event.preventDefault(); addTip();" style="margin-top: 30px;">
                <h4>Share Your Tip</h4>
                <label for="tip-username">Your Name:</label>
                <input type="text" id="tip-username" required>

                <label for="tip-text">Your Tip:</label>
                <textarea id="tip-text" placeholder="Enter your best organic farming tip here..." required></textarea>

                <button type="submit">Submit Tip</button>
            </form>

            <button onclick="goBackToDashboard()">üîô Back to Dashboard</button>
        </div>
    </main>

    <main class="hidden" id="cropSuggestion">
        <div class="form-container">
            <h3>Crop Suggestion Tool üåæ</h3>
            <form onsubmit="event.preventDefault(); showCropResult();">
                <label for="region">Region/State:</label>
                <input type="text" id="region" placeholder="e.g., Maharashtra, Punjab" required>

                <label for="soil">Soil Type:</label>
                <input type="text" id="soil" placeholder="e.g., Loamy, Sandy, Clay" required>

                <label for="season">Season:</label>
                <select id="season" required>
                    <option value="" disabled selected>Select Season</option>
                    <option value="Kharif">Kharif</option>
                    <option value="Rabi">Rabi</option>
                    <option value="Zaid">Zaid</option>
                </select>

                <button type="submit">Get Suggestions</button>
            </form>
        </div>

        <div class="form-container hidden" id="cropResult">
            <h3>Recommended Crops üå±</h3>
            <ul id="cropList"></ul>
            <button onclick="goBackToDashboard()">üîô Back to Dashboard</button>
        </div>
    </main>

    <main class="hidden" id="weatherForecast">
        <div class="form-container">
            <h3>üå¶Ô∏è Weather Forecast</h3>
            <form onsubmit="event.preventDefault(); getWeatherForecast();">
                <label for="citySearchInput">Enter City Name:</label>
                <input type="text" id="citySearchInput" placeholder="e.g., Pune, Ludhiana" required>
                <button type="submit" style="margin-top: 15px;">Get Weather</button>
            </form>
            <p style="margin-top: 20px;"><strong>Date:</strong> <span id="weatherDate"></span></p>
            <p id="todayWeather"><em>Enter a city to get the forecast.</em></p>
            <h4>üóìÔ∏è Weekly Outlook</h4>
            <table id="forecastTable">
                <tr><th>Day</th><th>Temperature (¬∞C)</th><th>Weather</th></tr>
            </table>
            <button onclick="goBackToDashboard()">üîô Back to Dashboard</button>
        </div>
    </main>

    <main class="hidden" id="products">
        <div class="form-container">
            <h3>üìà Organic Product Prices</h3>
            <div class="products-list">
                <h4>1. Organic Fruits & Vegetables üçéü•¶</h4>
                <p>These are staples in the organic market. Since they are grown naturally, their prices are often higher than conventional produce due to smaller yields and more labor-intensive farming methods.</p>
                <ul>
                    <li><strong>Tomatoes:</strong> Roughly ‚Çπ60-‚Çπ90 per kg.</li>
                    <li><strong>Onions:</strong> Around ‚Çπ80-‚Çπ100 per kg.</li>
                    <li><strong>Potatoes:</strong> About ‚Çπ80-‚Çπ95 per kg.</li>
                    <li><strong>Leafy Greens (Spinach/Palak):</strong> ‚Çπ100-‚Çπ120 per kg.</li>
                </ul>

                <h4>2. Organic Grains & Pulses üåæ</h4>
                <p>Organic grains and pulses are popular for daily cooking as they are free from chemical residues and often contain more nutrients.</p>
                <ul>
                    <li><strong>Toor Dal (Pigeon Peas):</strong> ‚Çπ180-‚Çπ240 per kg.</li>
                    <li><strong>Moong Dal (Green Gram):</strong> ‚Çπ160-‚Çπ200 per kg.</li>
                    <li><strong>Organic Wheat Flour:</strong> ‚Çπ60-‚Çπ90 per kg.</li>
                    <li><strong>Basmati Rice:</strong> ‚Çπ250-‚Çπ350 per kg.</li>
                </ul>

                <h4>3. Organic Dairy Products ü•õ</h4>
                <p>Organic dairy products, like milk and ghee, come from cows that are not treated with antibiotics or growth hormones and are fed organic fodder.</p>
                <ul>
                    <li><strong>Organic Milk (A2 Cow Milk):</strong> ‚Çπ60-‚Çπ100 per liter.</li>
                    <li><strong>Organic Cow Ghee:</strong> ‚Çπ700-‚Çπ1,600 per 500g.</li>
                </ul>

                <h4>4. Organic Spices & Oils ‚ú®</h4>
                <p>These products are beneficial for enhancing flavor and nutritional value without artificial additives.</p>
                <ul>
                    <li><strong>Turmeric Powder:</strong> ‚Çπ150-‚Çπ200 per 250g.</li>
                    <li><strong>Cold-Pressed Coconut Oil:</strong> ‚Çπ300-‚Çπ500 per 500ml.</li>
                    <li><strong>Mustard Oil:</strong> ‚Çπ350-‚Çπ450 per liter.</li>
                </ul>

                <h4>5. Other Organic Products üçØüå±</h4>
                <p>The organic market also includes a wide range of other items for a healthier lifestyle.</p>
                <ul>
                    <li><strong>Honey:</strong> ‚Çπ250-‚Çπ400 per 250g.</li>
                    <li><strong>Jaggery Powder:</strong> ‚Çπ80-‚Çπ120 per kg.</li>
                    <li><strong>Moringa Powder:</strong> ‚Çπ250-‚Çπ300 per 100g.</li>
                </ul>
            </div>
            <button onclick="goBackToDashboard()">üîô Back to Dashboard</button>
        </div>
    </main>

    <main class="hidden" id="pestAlerts">
        <div class="form-container">
            <h3>üêõ Pest Alert & Detection</h3>
            <p><strong>Common Crop Pests:</strong></p>
            <ul>
                <li><strong>Aphids:</strong> Small sap-sucking insects affecting vegetables & fruits.</li>
                <li><strong>Armyworms:</strong> Damage leaves of maize, paddy, and sorghum.</li>
                <li><strong>Whiteflies:</strong> Spread viruses in cotton and tomato crops.</li>
                <li><strong>Stem Borers:</strong> Found in rice and sugarcane.</li>
            </ul>

            <p><strong>Preventive Measures:</strong></p>
            <ul>
                <li>Rotate crops regularly to avoid pest buildup.</li>
                <li>Use neem-based organic pesticides.</li>
                <li>Introduce natural predators like ladybugs.</li>
                <li>Monitor crops weekly using traps or sensors.</li>
            </ul>

            <h4>üé• Learn How to Identify Pests</h4>
            <iframe src="https://www.youtube.com/embed/em5t8bScq9s" frameborder="0" allowfullscreen></iframe>

            <button onclick="goBackToDashboard()">üîô Back to Dashboard</button>
        </div>
    </main>

    <main class="hidden" id="aiAssistant">
        <div class="form-container">
            <h3>üë®‚Äçüåæ Talk to AI Expert</h3>
            <p>Ask me anything about organic farming, pests, or soil health.</p>
            <textarea id="userQuestion" placeholder="e.g., How can I improve my soil's health?"></textarea>
            <button onclick="askAI()">Ask AI</button>
            <div id="aiResponse" class="ai-response-box">
                Hello! I'm here to help. What's your question?
            </div>
            <button onclick="goBackToDashboard()">üîô Back to Dashboard</button>
        </div>
    </main>

    <main class="hidden" id="govSchemes">
        <div class="form-container">
            <h3>üìã Government Schemes for Organic Farmers</h3>
            <ul>
                <li><strong>Paramparagat Krishi Vikas Yojana (PKVY):</strong> Subsidy for organic farming adoption.</li>
                <li><strong>National Project on Organic Farming (NPOF):</strong> Financial assistance for organic inputs.</li>
                <li><strong>Soil Health Card Scheme:</strong> Free soil testing and nutrient management guidance.</li>
                <li><strong>Pradhan Mantri Fasal Bima Yojana:</strong> Crop insurance for risk mitigation.</li>
            </ul>
            <button onclick="goBackToDashboard()">üîô Back to Dashboard</button>
        </div>
    </main>

    <footer>
        <p>¬© 2025 GreenHarvest Portal | Built for sustainable farming üå±</p>
    </footer>

    <script>
        // Global message box handler
        function showMessage(text) {
          const messageBox = document.getElementById('message-box');
          messageBox.textContent = text;
          messageBox.classList.remove('hidden');
          messageBox.classList.add('show');
          setTimeout(() => {
            messageBox.classList.remove('show');
            setTimeout(() => {
              messageBox.classList.add('hidden');
            }, 500);
          }, 3000);
        }

        // Show/hide helper functions
        function hideAllSections() {
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('cropSuggestion').classList.add('hidden');
            document.getElementById('weatherForecast').classList.add('hidden');
            document.getElementById('products').classList.add('hidden');
            document.getElementById('pestAlerts').classList.add('hidden');
            document.getElementById('govSchemes').classList.add('hidden');
            document.getElementById('principles').classList.add('hidden');
            document.getElementById('benefits').classList.add('hidden');
            document.getElementById('community-tips').classList.add('hidden');
            document.getElementById('heroSection').classList.add('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('signupForm').classList.add('hidden');
            document.getElementById('aiAssistant').classList.add('hidden');

            // Reset crop result display
            document.getElementById('cropResult').classList.add('hidden');
            document.getElementById('cropList').innerHTML = '';
            document.getElementById('cropSuggestion').querySelector('form').reset();
        }

        function showDashboard() {
            hideAllSections();
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('heroSection').classList.remove('hidden');
        }

        function showLogin() {
            hideAllSections();
            document.getElementById('loginForm').classList.remove('hidden');
        }

        function showSignup() {
            hideAllSections();
            document.getElementById('signupForm').classList.remove('hidden');
        }

        function showCropSuggestion() {
            hideAllSections();
            document.getElementById('cropSuggestion').classList.remove('hidden');
        }

        function showCropResult() {
            const region = document.getElementById('region').value.toLowerCase();
            const soil = document.getElementById('soil').value.toLowerCase();
            const season = document.getElementById('season').value;

            const recommendations = [];

            // Basic logic for crop suggestions
            if (season === 'Kharif') {
                if (soil.includes('loamy') || soil.includes('clay')) {
                    recommendations.push('Rice', 'Maize', 'Cotton');
                } else if (soil.includes('sandy')) {
                    recommendations.push('Pearl Millet', 'Sorghum');
                }
            } else if (season === 'Rabi') {
                if (soil.includes('loamy') || soil.includes('clay')) {
                    recommendations.push('Wheat', 'Barley', 'Mustard');
                } else if (soil.includes('sandy')) {
                    recommendations.push('Gram', 'Lentils');
                }
            } else if (season === 'Zaid') {
                recommendations.push('Watermelon', 'Muskmelon', 'Cucumber');
            }

            if (recommendations.length === 0) {
                recommendations.push('No suggestions found for the given inputs.');
            }

            const listElem = document.getElementById('cropList');
            listElem.innerHTML = '';
            recommendations.forEach(crop => {
                const li = document.createElement('li');
                li.textContent = crop;
                listElem.appendChild(li);
            });

            document.getElementById('cropResult').classList.remove('hidden');
        }

        function showProducts() {
            hideAllSections();
            document.getElementById('products').classList.remove('hidden');
        }

        function showPestAlerts() {
            hideAllSections();
            document.getElementById('pestAlerts').classList.remove('hidden');
            document.getElementById('heroSection').classList.add('hidden');
        }

        function showGovSchemes() {
            hideAllSections();
            document.getElementById('govSchemes').classList.remove('hidden');
        }

        function showAIAssistant() {
            hideAllSections();
            document.getElementById('aiAssistant').classList.remove('hidden');
        }

        function goBackToDashboard() {
            showDashboard();
        }

        // New section functions
        function showPrinciples() {
            hideAllSections();
            document.getElementById('principles').classList.remove('hidden');
        }

        function showBenefits() {
            hideAllSections();
            document.getElementById('benefits').classList.remove('hidden');
        }
        
        // Community Tips functionality
        function showCommunityTips() {
            hideAllSections();
            document.getElementById('community-tips').classList.remove('hidden');
            renderTips();
        }

        function addTip() {
            const username = document.getElementById('tip-username').value.trim();
            const tipText = document.getElementById('tip-text').value.trim();

            if (!username || !tipText) {
                showMessage("Please fill out both fields.");
                return;
            }

            let tips = JSON.parse(sessionStorage.getItem('communityTips')) || [];
            tips.unshift({ username, text: tipText });
            sessionStorage.setItem('communityTips', JSON.stringify(tips));

            document.getElementById('tip-username').value = '';
            document.getElementById('tip-text').value = '';

            renderTips();
            showMessage("Your tip has been added!");
        }

        function renderTips() {
            const tipsContainer = document.getElementById('tips-list');
            const noTipsMessage = document.getElementById('no-tips-message');
            const tips = JSON.parse(sessionStorage.getItem('communityTips')) || [];
            tipsContainer.innerHTML = '';

            if (tips.length === 0) {
                noTipsMessage.textContent = 'No tips yet. Be the first to add one!';
            } else {
                noTipsMessage.textContent = '';
                tips.forEach(tip => {
                    const tipCard = document.createElement('div');
                    tipCard.style.cssText = `
                        background-color: #f0f0f0;
                        padding: 15px;
                        border-radius: 8px;
                        margin-bottom: 10px;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                    `;
                    tipCard.innerHTML = `
                        <p style="margin: 0; font-weight: bold; color: #333;">${tip.text}</p>
                        <p style="margin: 5px 0 0; font-size: 0.9em; color: #777;">- ${tip.username}</p>
                    `;
                    tipsContainer.appendChild(tipCard);
                });
            }
        }

        // AI Assistant Functionality
        function askAI() {
            const userQuestion = document.getElementById('userQuestion').value.toLowerCase();
            const responseBox = document.getElementById('aiResponse');
            responseBox.innerHTML = '<span class="loading-dots">Thinking</span>';
            
            setTimeout(() => {
                let answer = "I'm not sure how to answer that question, but I can help with topics like pest control, soil health, and crop suggestions for organic farming.";

                if (userQuestion.includes('soil health') || userQuestion.includes('improve soil')) {
                    answer = `
                        To improve your soil health, consider these organic methods:
                        <br><br>
                        <strong>1. Compost:</strong> Add organic matter like compost to increase nutrient content and water retention.
                        <br>
                        <strong>2. Cover Crops:</strong> Plant non-cash crops like clover or rye to prevent erosion and add nitrogen to the soil.
                        <br>
                        <strong>3. Crop Rotation:</strong> Change the type of crop you grow in a specific area each season to maintain soil fertility and prevent nutrient depletion.
                        <br>
                        <strong>4. Avoid Tilling:</strong> Excessive tilling can destroy the natural soil structure and harm beneficial microorganisms.
                    `;
                } else if (userQuestion.includes('pests') || userQuestion.includes('insects')) {
                    answer = `
                        Organic pest control is a great way to protect your crops. Here are a few options:
                        <br><br>
                        <strong>1. Neem Oil:</strong> A natural, biodegradable pesticide that is effective against a wide range of pests.
                        <br>
                        <strong>2. Companion Planting:</strong> Plant crops together that repel each other's pests (e.g., planting basil near tomatoes to deter tomato hornworms).
                        <br>
                        <strong>3. Introduce Predators:</strong> Ladybugs, lacewings, and praying mantises are natural predators of common garden pests like aphids and mites.
                    `;
                } else if (userQuestion.includes('crop suggestions')) {
                    answer = "I can't give you a precise crop suggestion without more information. Please use the 'Crop Suggestions' tool on the dashboard. You'll need to provide your region, soil type, and the season.";
                } else if (userQuestion.includes('organic farming')) {
                    answer = "Organic farming is a method of crop and livestock production that avoids the use of synthetic fertilizers, pesticides, and genetically modified organisms. It focuses on using natural methods to improve soil health and biodiversity.";
                } else if (userQuestion === '') {
                    answer = "Please type your question into the box above. I'm ready to assist you!";
                }

                responseBox.innerHTML = answer;
            }, 1500);
        }

        // Weather API functionality
        const apiKey = '5d6da78c13c7a30294598424c2d767ba'; // NOTE: This is a sample key. Use your own key in production.

        async function getWeatherForecast() {
            const city = document.getElementById('citySearchInput').value;
            if (!city) return;

            document.getElementById('todayWeather').innerHTML = `<em>Fetching weather for ${city}...</em>`;
            const forecastTable = document.getElementById('forecastTable');
            forecastTable.innerHTML = `<tr><th>Day</th><th>Temperature (¬∞C)</th><th>Weather</th></tr>`;

            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city},IN&appid=${apiKey}&units=metric`);
                const data = await response.json();

                if (data.cod !== "200") { // Check if the API returned an error
                    document.getElementById('todayWeather').innerHTML = `<strong>Error:</strong> ${data.message || `Could not fetch data for "${city}"`}`;
                    return;
                }

                const todayForecast = data.list[0];
                const weather = todayForecast.weather[0].description;
                const temp = todayForecast.main.temp;
                const humidity = todayForecast.main.humidity;

                document.getElementById('todayWeather').innerHTML = `
                    <strong>Current Forecast for ${city}:</strong> ${weather}, ${Math.round(temp)}¬∞C, Humidity: ${humidity}%
                `;

                const forecastByDay = {};
                for (let item of data.list) {
                    // Process forecast for midday (12:00:00) to get one entry per day
                    if (item.dt_txt.includes("12:00:00")) {
                        const date = new Date(item.dt_txt);
                        const day = date.toLocaleDateString(undefined, { weekday: 'short' });
                        // Prevent duplicate days
                        if (!forecastByDay[day]) {
                            forecastByDay[day] = {
                                temp: item.main.temp,
                                weather: item.weather[0].main
                            };
                        }
                    }
                }

                for (let day in forecastByDay) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${day}</td>
                        <td>${Math.round(forecastByDay[day].temp)}</td>
                        <td>${forecastByDay[day].weather}</td>
                    `;
                    forecastTable.appendChild(row);
                }

            } catch (error) {
                document.getElementById('todayWeather').innerHTML = `‚ö†Ô∏è Error fetching weather data. Please check your connection.`;
                console.error('Weather API Error:', error);
            }
        }

        function showWeatherForecast() {
            hideAllSections();
            document.getElementById('weatherForecast').classList.remove('hidden');

            const today = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('weatherDate').textContent = today.toLocaleDateString(undefined, options);
            
            // Reset the search input and results
            document.getElementById('citySearchInput').value = '';
            document.getElementById('todayWeather').innerHTML = '<em>Enter a city to get the forecast.</em>';
            document.getElementById('forecastTable').innerHTML = `<tr><th>Day</th><th>Temperature (¬∞C)</th><th>Weather</th></tr>`;
        }

        // Initial view
        showLogin();
    </script>
</body>
</html>
